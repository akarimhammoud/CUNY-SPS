---
title: "Karim Hammoud - 607 Final Project"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
params: 
  stock: AAPL
---


```{r setup, include=FALSE}
# Prepare the environment

library(flexdashboard)
library(knitr)
library(DT)
library(rpivotTable)
library(ggplot2)
library(plotly)
library(dplyr)
library(openintro)
library(highcharter)
library(ggvis)
library(quantmod)
library('tibble')
library(janeaustenr)
library(gutenbergr)
library(stringr)
library(tidytext)
library(textdata)
library(jsonlite)
library(tidyverse)
library(wordcloud)
library(reshape2)
```


```{r}
# Prepare the data for SP, DOW, Nasdaq, and Wilshire.

data <- read.csv("/Users/karimh/Documents/Google Drive/R language/Flexboards/VehicleFailure.csv")
```

```{r}
#SP500
sp <- getSymbols("^GSPC", auto.assign = F, from = "2020-01-01", to = "2021-12-01", return.class='data.frame')
sp <-  sp %>% rownames_to_column('date')

sp1 <- head(sp, n=1)

sp2 <- sp1$GSPC.Adjusted * sp$GSPC.Volume

#Dow Jones
dow <- getSymbols("^DJI", auto.assign = F, from = "2020-01-01", to = "2021-12-01", return.class='data.frame')
dow <-  dow %>% rownames_to_column('date')


#Russell 2000
ndx <- getSymbols("^NDX", auto.assign = F, from = "2020-01-01", to = "2021-12-01", return.class='data.frame')
ndx <-  ndx %>% rownames_to_column('date')



#Wilshire 5000
wil <- getSymbols("^W5000", auto.assign = F, from = "2020-01-01", to = "2021-12-01", return.class='data.frame')
wil <-  wil %>% rownames_to_column('date')
```

```{r}
mycolors <- c("res", "#FFC125", "darkgreen", "darkorange")
```




OVERVIEW
========================================
**Final Project -607 Data Acquisition and Management**

**By Karim hammoud**

For the final project, I will analyze SP 500 and pick one of the companies stock like Apple, with my 6 years in the finance industry I am inspired to find specific trends that move the market like corporate influence, news, and political status.

There are multiple variables to be analyzed in this like market capitals, trading volume and prices.  

U.S. Stock Market Indexes


Sources:

I will use multiple sources like web scraping Wikipedia https://en.wikipedia.org/wiki/List_of_S%26P_500_companies

Quantmod for financial data.

NYT API for the news and sentiment analysis.




TOP US FINANCIAL INDEXES
=====================================

Row
-------------------------------------

### 2020 Stock Pricing Analysis

```{r}
valueBox(paste("TOP US FINANCIAL INDEXES"),
         color = "warning")
```

### 2020 Trading days

```{r}
valueBox(length(sp$GSPC.Open))
```

### Market Cap in $Trillions
```{r}
valueBox(round(max(sp2/1000000000000), digits = 2))
```

### 2020 SP 500 highest value

```{r}
valueBox(round(max(sp$GSPC.High), digits = 0),
         color = "success")
```

### 2020 SP 500 lowest value

```{r}
valueBox(round(min(sp$GSPC.Low), digits = 0),
         color = "danger")
```


### Highest Trading Volumne

```{r}
valueBox(max(sp$GSPC.Volume),
         color = "success")
```


### Lowest Trading Volumne

```{r}
valueBox(min(sp$GSPC.Volume),
         color = "danger")
```


Row
-------------------------------

### Dow Jones 

```{r}
p3 <- plot_ly(dow,
              x = ~date,
               y = ~DJI.Adjusted,
              text = paste("Date:", dow$date,
                           "Average:",
                           dow$DJI.Adjusted),
              type = "bar") %>%
         layout(xaxis = list(title="Date"),
                yaxis = list(title = "Price"))
p3
```



### The Top 4 Major Indexes

![Financial Indexes https://www.investopedia.com/insights/introduction-to-stock-market-indices/](33.png)

```{r}

```


### NASDAQ-100

```{r}
p15 <- ndx %>%
         plot_ly(x = ~date,
                 y = ~NDX.Adjusted,
                 color = "blue",
                 type = 'bar') %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = 'Price'))
p15
```




Row
------------------------------------

### SP price 2020

```{r}
p14 <- sp %>%
         plot_ly(x = ~date,
                 y = ~GSPC.Adjusted,
                 color = "blue",
                 type = 'bar') %>%
layout(xaxis = list(title = "Date"),
yaxis = list(title = 'Price'))
p14
```





### S&P 500 Sectors percentages

![](22.png)

```{r}

```





### Wilshire 5000

```{r}
p13 <- plot_ly(wil,
              x = ~date,
               y = ~W5000.Adjusted,
              text = paste("Date:", wil$date,
                           "Average:",
                           wil$W5000.Adjusted),
              type = "bar") %>%
         layout(xaxis = list(title="Date"),
                yaxis = list(title = "Price"))
p13
```









S&P 500 LIST
========================================

```{r}
library(rvest)

wiki <- read_html("https://en.wikipedia.org/wiki/List_of_S%26P_500_companies")

wiki_table <- wiki %>% html_nodes("table") %>%  .[1] %>% html_table(header = TRUE, fill = TRUE) %>% .[[1]]

datatable(wiki_table,
          caption = "List of S&P 500 Companies from Wikipedia",
          rownames = T,
          filter = "top",
          options = list(pageLength = 25))
```
















NYT ON APPLE
========================================

```{r message=FALSE}
library(httr)
library(jsonlite)
library(dplyr)
library(kableExtra)

```

```{r echo=FALSE}
# set a hidden key
apiKey = "zcrDXGxt3ZqFK7IRk5jqJCGUt6lPmVPA"
```

```{r}
# Get the data from the NYT API of article search and select any article with Apple word in it.
url  <- "https://api.nytimes.com/svc/search/v2/articlesearch.json?begin_date=20200715&end_date=20201001"


nyt <- GET(url, query=list(q="apple","api-key"=apiKey))

```


```{r}
# Access and convert the data
nyt_data <- content(nyt, as = "parsed") 

# Access data element of whole list and ignore the other vectors
nyt_json <- nyt_data$response$docs

#Convert to an array
arr <- array(nyt_json)

#Get number of items in list
length <- length(nyt_json)

#Establish matrix to construct our data frame 
m <- matrix(ncol = 11, nrow = length)

row <- 1
```



```{R}
# Get the matrix and populate with list items 
for(i in 1:length){
  for ( j in arr[i]) { 
    if(j$web_url != "")
      m[row, 1] <- (j$`web_url`)
    
    if(j$snippet != "")
      m[row, 2] <- j$snippet
    
    if(j$lead_paragraph != "")
      m[row, 3] <- j$lead_paragraph
    
    if(j$abstract != "")
      m[row, 4] <- j$abstract
    
    if(j$source != "")
      m[row, 5] <- j$source
    
    if(!is.null(j$headline[1]$main))
      m[row, 6] <- j$headline[1]$main

    if(!is.null(j$pub_date))
      m[row, 7] <- j$pub_date

    if(!is.null(j$document_type))
      m[row, 8] <- j$document_type
    
    if(!is.null(j$news_desk))
      m[row, 9]  <- j$news_desk
    
    if(!is.null(j$word_count))
      m[row, 10] <- j$word_count
    
    if(!is.null(j$type_of_material))
      m[row, 11] <- j$type_of_material
    row <- row + 1
    
  }
}
```
 
 
```{r}
# Show the table and conclusion
final_data <- data.frame(m)
columns <- c('Link','summary','paragraph','abstract', 'news', 'main', 'pub_date', 'document', 'news_desk', 'word_count', 'type')

colnames(final_data) <- columns

final_data %>% 
 kable() %>%  
 kable_styling()
```



APPLE ANALYSIS
========================================

Row
-------------------------------------

```{r , include=FALSE}
knitr::opts_chunk$set(echo = FALSE); knitr::opts_chunk$set(warning = FALSE) #-- Hide code and messages
library(magrittr); library(dygraphs) #-- Load needed libraries
stock <- quantmod::getSymbols(params$stock, auto.assign = FALSE) #-- Get stock data

stock3 <- getSymbols("aapl", auto.assign = F, from = "2020-01-01", to = "2021-12-01", return.class='data.frame')
stock3 <-  stock3 %>% rownames_to_column('date')

stock1 <- head(stock3, n=1)

stock2 <- stock1$AAPL.Adjusted * stock1$AAPL.Volume

```


### 2020 Stock Pricing Analysis

```{r}
valueBox(paste("APPLE COMPANY ANALYSIS"),
         color = "warning")
```


### Market Cap in $Trillions
```{r}
valueBox(paste("1.995T"))
```

### 2020 Apple highest value

```{r}
valueBox(round(max(stock3$AAPL.Adjusted), digits = 0),
         color = "success")
```

### 2020 Apple lowest value

```{r}
valueBox(round(min(stock3$AAPL.Adjusted), digits = 0),
         color = "danger")
```


### 2020 Apple Highest Trading Volumne

```{r}
valueBox(max(stock3$AAPL.Volume),
         color = "success")
```


### 2020 Apple Lowest Trading Volumne

```{r}
valueBox(min(stock3$AAPL.Volume),
         color = "danger")
```


Row
-------------------------------------

### Volume from 2019 - 2020 `r params$stock`

```{r}
dygraph(stock[c('2019', '2020'), 5]) %>% dyRangeSelector() 
```

### Price range from 2019 - 2020 - `r params$stock`

```{r}
dygraph(stock[c('2019', '2020'), c(1:4)]) %>% dyCandlestick() 
```


Row
-------------------------------------

### Sentiment for NYT on Apple from July to Sept

```{r}
library(sentimentr)
library(data.table)
library(tidyverse)
library(plyr)

#Summarize sentiments
nyt3 <- sentiment_by(final_data$summary)



#Generates a sentiment class based on average score
nyt_df<- setDF(nyt3)
get_sentiment_class <- function(ave_sentiment){
  sentiment_class="Positive"
if (ave_sentiment < -.3){
  sentiment_class = "Negative"}
else if (ave_sentiment<.3){
  sentiment_class = "Neutral"
}
sentiment_class
}


nyt_df$ave_sentiment <- sapply(nyt_df$ave_sentiment,get_sentiment_class)

ggplot(data=nyt_df,aes(x=ave_sentiment,fill=ave_sentiment))+geom_bar()
```


### NYT Sentiment for July 31 Article

```{r warning=FALSE}
library(stringr)
library(tm)
library(RTextTools)
library(tidyverse)
library(SnowballC)
library(knitr)
library(tidytext)
library(wordcloud)
library(caret)
library(gbm)
library(e1071)
library(naivebayes)

nyt20 <- read_html("https://www.nytimes.com/2020/07/30/technology/tech-company-earnings-amazon-apple-facebook-google.html")

nyt_nodes <-  html_nodes(nyt20, ".evys1bk0")

nyt21 <- html_text(nyt_nodes)

nyt21 <-tolower(nyt21)

nyt21 <-removeWords(nyt21,stopwords('en'))

nyt21 <-removePunctuation(nyt21)

nyt21 <-stripWhitespace(nyt21)


wordcloud(nyt21, max.words =100,min.freq=100, random.order = FALSE,rot.per=.5, color=brewer.pal(8,"Dark2"))
```


### NYT Sentiment on Apple from July to Sept

```{r}
library(syuzhet)

nyt22 <- iconv(nyt21, to = "utf-8-mac")

s <- get_nrc_sentiment(nyt22)

barplot(100*colSums(s)/sum(s),
        las = 2,
        ylab = "percentages",
        ylim=c(0,30),
        col=rgb(0.2,0.4,0.6,0.6),
        main = "nrc Sentiment Scores for NYT Article")
```















CONCLUSION
========================================

Based on the analysis I did, it showed all of the stocks indexes had fall down in march and april 2020 when 

On the dashboard tab: it showed the data for SP, DOW, Nasdaq, and Wilshire with with pie chart for the top also the market cap and trading volume for the last trading day.
 
On the SP 500 list it was collected from Wikipedia and it shows a searchable table for all of the tickers and companies at SP 500, in addition to searchable to the year it was added to the sp list.

On the NYT APPLE, the data was collected from new york times API and it showes the articles about the apple inc, and summary and paragraph.

On the apple analysis tab, it showes the apple company stock analysis with market cap and lowest stock price in 2020, and stock trending the volume as well. and I created a sentiment analysis, for positive and negative on the paragraph, and I chose july 31 article because there is a increase in the date, and checked the nrc sentiment analysis for the nyt article. 

Chech this article https://www.nytimes.com/2020/07/30/technology/tech-company-earnings-amazon-apple-facebook-google.html


Created by: Karim Hammoud






