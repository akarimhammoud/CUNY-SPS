---
title: "W9 - Working with web APIs"
author: "Karim Hammoud"
date: "`r Sys.Date()`"
output:
  html_document:
    highlight: pygments
    theme: cerulean
    toc: yes
    toc_float: yes
  pdf_document: default
  openintro::lab_report: default
editor_options:
  chunk_output_type: console
---

### Overview

The New York Times web site provides a rich set of APIs, as described here: https://developer.nytimes.com/apis Youâ€™ll need to start by signing up for an API key.
Your task is to choose one of the New York Times APIs, construct an interface in R to read in the JSON data, and transform it into an R DataFrame.

Environment preperation

```{r message=FALSE}
library(httr)
library(jsonlite)
library(dplyr)
library(kableExtra)

```

```{r echo=FALSE}
# set a hidden key
apiKey = "zcrDXGxt3ZqFK7IRk5jqJCGUt6lPmVPA"
```

### Get the data from the NYT API of article search and select any article with Apple word in it.
```{r}
url  <- "https://api.nytimes.com/svc/search/v2/articlesearch.json"

nyt <- GET(url, query=list(q="apple","api-key"=apiKey))

```

Access and convert the data
```{r}
nytdata <- content(nyt, as = "parsed") 

# Access data element of whole list and ignore the other vectors
modJson <- nytdata$response$docs 

#Convert to an array
arr <- array(modJson)

#Get number of items in list
iterations <- length(modJson)

#Establish matrix to construct our data frame 
m <- matrix(ncol = 11, nrow = iterations)

row <- 1
```


### Get the matrix and populate with list items 

```{R}
for(i in 1:iterations){
  for ( j in arr[i]) { 
    if(j$web_url != "")
      m[row, 1] <- (j$`web_url`)
    
    if(j$snippet != "")
      m[row, 2] <- j$snippet
    
    if(j$lead_paragraph != "")
      m[row, 3] <- j$lead_paragraph
    
    if(j$abstract != "")
      m[row, 4] <- j$abstract
    
    if(j$source != "")
      m[row, 5] <- j$source
    
    if(!is.null(j$headline[1]$main))
      m[row, 6] <- j$headline[1]$main

    if(!is.null(j$pub_date))
      m[row, 7] <- j$pub_date

    if(!is.null(j$document_type))
      m[row, 8] <- j$document_type
    
    if(!is.null(j$news_desk))
      m[row, 9]  <- j$news_desk
    
    if(!is.null(j$word_count))
      m[row, 10] <- j$word_count
    
    if(!is.null(j$type_of_material))
      m[row, 11] <- j$type_of_material
    
    row <- row + 1
  }
}
```

### Show the table and conclusion
```{r}
my_data <- data.frame(m)
columns <- c('web_url','snippet','lead_paragraph','abstract', 'source', 'main', 'pub_date', 'document_type', 'news_desk', 'word_count', 'type_of_material')

colnames(my_data) <- columns

my_data %>% 
 kable() %>%  
 kable_styling()
```

